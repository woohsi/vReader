# vReader越南语文章阅读助手

### 核心定位
面向“越南语新闻阅读”的语言理解增强层，不是简单翻译/查词；在不破坏原网页结构的前提下，把阅读变成“可理解、可学习、可积累”的体验。

### 双语呈现
中文译文是**紧接在每个原文段落下方**展示（段落级对齐），可一键开关显示/隐藏译文。

### 高亮标注策略（默认即渲染）
  - 页面一进入就**预先渲染**所有已识别的高价值语言单位：**单词、词组/搭配、句式、俗语**。
  - **用不同颜色**区分不同类型（用户一眼能扫到“这是什么类别”）。
  - 高亮整体要“克制、友好”，不抢阅读注意力，但能随时被识别到。

### 悬停/句子级交互（读时增强）
  - 当光标移动到**某一句**之上时：立刻“进入该句的阅读模式”，**该句内所有已标注单位同时显著高亮**（不同类型不同色）。
  - 原文/译文任意一句悬停 → 自动联动高亮对应句子”。
  - Hover 主要用于“识别 + 强调”，避免自动弹出大量解释内容打断阅读。

### 点击才进入解释/查询
  - 点击已高亮的语言单位：打开解释面板（后续才接大模型），基于**当前新闻语境**生成结构化解释卡（真实含义、为什么这样用、语用色彩、替换表达等）。

### 漏网之鱼的精确查询（选中触发）
  - 对未被标注、但用户不确定的内容：允许用户**选中文本**。
  - 选中后在旁边出现一个**search 图标**。
  - 用户点击 search 图标后：执行“精确查询”（后续接大模型/检索），并在面板中展示结果。

### 颜色
- **句子激活态背景（原文/译文联动）**
  - `#ACF562`，透明度 `0.24`（当前为 `rgb(172 245 98 / 0.24)`）

- **语言单位：单词（unit-word）**
  - 背景：`#FDE68A`（base/active 用同色，不同透明度）
  - 细描边（默认）：`#F59E0B`（inset 1px，带透明度）
  - 激活描边（句子悬停时更强）：`#D97706`（inset 1px，带透明度）

- **语言单位：词组/搭配（unit-phrase）**
  - 背景：`#BAE6FD`
  - 细描边（默认）：`#0EA5E9`
  - 激活描边：`#0284C7`

- **语言单位：句式（unit-pattern）**
  - 背景：`#F5D0FE`
  - 细描边（默认）：`#D946EF`
  - 激活描边：`#C026D3`

- **语言单位：俗语（unit-idiom）**
  - 背景：`#A7F3D0`
  - 细描边（默认）：`#10B981`
  - 激活描边：`#059669`

- **中性强调（描边/外圈）**
  - 主要中性黑：`#18181B`（用于 hover/active 外圈的阴影色源，带不同透明度）

**透明度（由“密度”按钮控制）**
- 默认高亮（base）：alpha = `0.26 / 0.32 / 0.40`（低/中/高）
- 句子激活时（active）：alpha = `0.58 / 0.68 / 0.78`（低/中/高）


curl -X POST "https://api.yourdomain.com/v1/documents/translate-analyze" \
  -H "Content-Type: application/json" \
  -H "X-Request-Id: 2c1c8d2a-8f4c-4b12-9b2c-9a7d62a7f6c1" \
  -d '{
    "docId": "sha256:https://example.com/news/xxx#mainTextHash",
    "url": "https://example.com/news/xxx",
    "sourceLang": "vi",
    "targetLang": "zh",
    "title": "Doanh nghiệp Việt tăng tốc chuyển đổi số trong bối cảnh thị trường biến động",
    "client": {
      "app": "vReader-chrome",
      "version": "0.1.0"
    },
    "indexing": {
      "offsetBasis": "sentenceText",
      "stringIndex": "utf16_code_unit"
    },
    "options": {
      "returnTranslation": true,
      "returnUnits": true,
      "translationGranularity": "sentence",
      "unitTypes": ["word", "phrase", "pattern", "idiom"]
    },
    "blocks": [
      {
        "blockId": "p1",
        "blockType": "paragraph",
        "text": "Theo khảo sát mới công bố, nhiều doanh nghiệp đang không chỉ đầu tư vào hạ tầng, mà còn ưu tiên đào tạo nhân lực. Trong bối cảnh chi phí tăng và nhu cầu thay đổi nhanh, các quyết định “đi trước” thường tạo khác biệt rõ rệt.",
        "sentences": [
          {
            "sid": "p1-s1",
            "text": "Theo khảo sát mới công bố, nhiều doanh nghiệp đang không chỉ đầu tư vào hạ tầng, mà còn ưu tiên đào tạo nhân lực."
          },
          {
            "sid": "p1-s2",
            "text": "Trong bối cảnh chi phí tăng và nhu cầu thay đổi nhanh, các quyết định “đi trước” thường tạo khác biệt rõ rệt."
          }
        ],
        "domAnchor": {
          "strategy": "data-attr",
          "attr": "data-vr-block-id",
          "value": "p1"
        }
      }
    ]
  }'

{
  "docId": "sha256:https://example.com/news/xxx#mainTextHash",
  "sourceLang": "vi",
  "targetLang": "zh",
  "indexing": {
    "offsetBasis": "sentenceText",
    "stringIndex": "utf16_code_unit"
  },
  "blocks": [
    {
      "blockId": "p1",
      "translation": {
        "sentences": [
          {
            "sid": "p1-s1",
            "text": "根据最新公布的调查，许多企业不仅投资基础设施，也优先培训人才。"
          },
          {
            "sid": "p1-s2",
            "text": "在成本上升、需求快速变化的背景下，“提前布局”的决策往往能带来明显差异。"
          }
        ]
      },
      "analysis": {
        "units": [
          {
            "unitId": "u-word-cong-bo",
            "type": "word",
            "sid": "p1-s1",
            "surface": "công bố",
            "range": { "start": 12, "end": 19 },
            "confidence": 0.86,
            "meta": {
              "lemma": "công bố",
              "glossZh": "公布"
            }
          },
          {
            "unitId": "u-pattern-khong-chi-ma-con",
            "type": "pattern",
            "sid": "p1-s1",
            "surface": "không chỉ... mà còn...",
            "patternParts": [
              { "surface": "không chỉ", "range": { "start": 46, "end": 53 } },
              { "surface": "mà còn", "range": { "start": 73, "end": 78 } }
            ],
            "confidence": 0.92,
            "meta": {
              "patternName": "không chỉ... mà còn...",
              "hintZh": "强调结构：不仅A，而且B"
            }
          },
          {
            "unitId": "u-phrase-trong-boi-canh",
            "type": "phrase",
            "sid": "p1-s2",
            "surface": "Trong bối cảnh",
            "range": { "start": 0, "end": 13 },
            "confidence": 0.90,
            "meta": {
              "glossZh": "在……背景下"
            }
          }
        ]
      }
    }
  ]
}  